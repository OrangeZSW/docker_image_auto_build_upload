<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多Git仓库监控与自动构建系统</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
<div class="container">
    <header>
        <h1>多Git仓库监控与自动构建系统</h1>
        <p>监控多个Git仓库变化，自动构建Docker镜像并推送到阿里云镜像仓库</p>
    </header>

    <div class="dashboard">
        <div class="config-panel">
            <h2>仓库管理</h2>

            <div class="repo-list" id="repoList">
                <div class="repo-item" data-repo-id="default">
                    <div class="repo-header">
                        <h3>新仓库</h3>
                        <div class="repo-actions">
                            <button class="btn-toggle" data-action="toggle">启用</button>
                            <button class="btn-edit" data-action="edit">编辑</button>
                            <button class="btn-delete" data-action="delete">删除</button>
                        </div>
                    </div>
                    <div class="repo-details">
                        <p><strong>Git地址:</strong> <span class="repo-giturl">未设置</span></p>
                        <p><strong>分支:</strong> <span class="repo-branch">main</span></p>
                        <p><strong>镜像:</strong> <span class="repo-image">未设置</span></p>
                    </div>
                </div>
            </div>

            <button id="addRepo">添加仓库</button>

            <div class="global-config">
                <h3>全局配置</h3>
                <div class="form-group">
                    <label for="pollInterval">检查间隔（分钟）</label>
                    <input type="number" id="pollInterval" min="1" value="5">
                </div>

                <div class="form-group">
                    <label for="aliyunRegistry">阿里云镜像仓库地址</label>
                    <input type="text" id="aliyunRegistry" placeholder="registry.cn-hangzhou.aliyuncs.com" value="registry.cn-hangzhou.aliyuncs.com">
                </div>

                <div class="form-group">
                    <label for="dockerUsername">Docker用户名</label>
                    <input type="text" id="dockerUsername" placeholder="阿里云用户名">
                </div>

                <div class="form-group">
                    <label for="dockerPassword">Docker密码</label>
                    <input type="password" id="dockerPassword" placeholder="阿里云密码或访问令牌">
                </div>
            </div>

            <button id="saveConfig">保存配置</button>
            <button id="testDockerLogin">测试Docker登录</button>
            <button id="startMonitor">开始监控</button>
            <button id="stopMonitor" class="btn-danger">停止监控</button>
        </div>

        <div class="status-panel">
            <h2>系统状态</h2>

            <div class="status-info">
                <p><span class="status-indicator status-inactive" id="statusIndicator"></span> 监控状态: <span id="monitorStatus">未运行</span></p>
                <p>最后检查: <span id="lastCheck">从未</span></p>
                <p>Docker登录状态: <span id="dockerLoginStatus">未测试</span></p>
            </div>

            <h3>仓库状态</h3>
            <div class="repo-status-list" id="repoStatusList">
                <div class="repo-status-item">
                    <div class="repo-status-header">
                        <h4>暂无仓库状态信息</h4>
                        <span class="status-badge badge-inactive">未监控</span>
                    </div>
                </div>
            </div>

            <h3>实时日志</h3>
            <div class="log-container" id="logContainer">
                <div class="log-entry log-info">系统就绪，等待配置...</div>
            </div>

            <h3>构建历史</h3>
            <div class="build-history" id="buildHistory">
                <div class="history-item">
                    <span>暂无构建记录</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 编辑仓库模态框 -->
<div class="modal" id="repoModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>编辑仓库配置</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="repoName">仓库名称</label>
                <input type="text" id="repoName" placeholder="my-app-repo">
            </div>

            <div class="form-group">
                <label for="repoGitUrl">Git仓库地址</label>
                <input type="text" id="repoGitUrl" placeholder="https://github.com/username/repo.git">
            </div>

            <div class="form-group">
                <label for="repoBranch">分支</label>
                <input type="text" id="repoBranch" placeholder="main" value="main">
            </div>

            <div class="form-group">
                <label for="repoRegistryNamespace">阿里云命名空间</label>
                <input type="text" id="repoRegistryNamespace" placeholder="my-namespace">
            </div>

            <div class="form-group">
                <label for="repoImageName">镜像名称</label>
                <input type="text" id="repoImageName" placeholder="my-app">
            </div>

            <div class="form-group">
                <label for="repoDockerfilePath">Dockerfile路径</label>
                <input type="text" id="repoDockerfilePath" placeholder="./Dockerfile" value="./Dockerfile">
            </div>

            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="repoEnabled" checked>
                    <span class="checkmark"></span>
                    启用此仓库监控
                </label>
            </div>

            <input type="hidden" id="repoId">
        </div>
        <div class="modal-footer">
            <button id="saveRepoConfig">保存</button>
            <button id="triggerBuildModal">立即构建</button>
            <button class="btn-danger" id="cancelRepoEdit">取消</button>
        </div>
    </div>
</div>

<!-- 仓库详情模态框 -->
<div class="modal" id="repoDetailModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="repoDetailTitle">仓库详情</h2>
            <span class="close">&times;</span>
        </div>
        <div class="modal-body">
            <div class="repo-detail-info">
                <p><strong>Git地址:</strong> <span id="detailGitUrl"></span></p>
                <p><strong>分支:</strong> <span id="detailBranch"></span></p>
                <p><strong>镜像:</strong> <span id="detailImage"></span></p>
                <p><strong>状态:</strong> <span id="detailStatus"></span></p>
                <p><strong>最后构建:</strong> <span id="detailLastBuild"></span></p>
            </div>

            <h3>构建历史</h3>
            <div class="repo-build-history" id="repoBuildHistory">
                <div class="history-item">
                    <span>暂无构建记录</span>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="triggerBuildDetail">立即构建</button>
            <button class="btn-danger" id="closeRepoDetail">关闭</button>
        </div>
    </div>
</div>

<script src="./script.js"></script>
</body>
</html>